<!DOCTYPE html>
<html >
	<head>
		<meta charset="UTF-8">
		<title>the unseen</title>
		<link rel="stylesheet" href="css/style.css">
                <script src="js/libs/dat.gui.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js" integrity="sha512-yNJzAsg5JyP91u+sLHlUDULMBd3hmEiVkYeeN1cQBKaLZ7EyT6oH2u5THNIRM2Fu6VKcZJv+F/QAp1h/qzy9Ow==" crossorigin="anonymous"></script>
	</head>
        <script id="vertexShader" type="x-shader/x-fragment">
	  varying vec2 texCoordVarying;
              uniform bool decode;
        uniform vec2 resolution;

	  void main() {
	      texCoordVarying = uv;
	      gl_Position =   projectionMatrix *
		  modelViewMatrix *
		  vec4(position,1.0);
	  }
	</script>
      <script id="fragmentShader" type="x-shader/x-fragment">
        uniform bool decode;
        uniform vec2 resolution;
        varying vec2 texCoordVarying;


        struct RGB{
            uint r;
            uint g;
            uint b;
        };

        void encode_image(inout RGB dstPixel, RGB srcPixel)
        {
            dstPixel.r = (dstPixel.r & uint(0xF0)) | (srcPixel.r & uint(0xF0)) >> 4;
            dstPixel.g = (dstPixel.g & uint(0xF0)) | (srcPixel.g & uint(0xF0)) >> 4;
            dstPixel.b = (dstPixel.b & uint(0xF0)) | (srcPixel.b & uint(0xF0)) >> 4;
        }


        void decode_image(inout RGB dstPixel)
        {
            dstPixel.r = (dstPixel.r & uint(0x0F)) << 4;
            dstPixel.g = (dstPixel.g & uint(0x0F)) << 4;
            dstPixel.b = (dstPixel.b & uint(0x0F)) << 4;
        }



        void main()
        {
            vec2 uv = texCoordVarying; vec3 col;
            vec3 color = vec3(0.);

            vec3 img1; vec3 img2;

            img1.xy += fract(uv*5.);
            img2 += cos(10.*length(uv));


            RGB dstPixel;RGB srcPixel;

            dstPixel.r = uint(img1.r*255.);
            dstPixel.g = uint(img1.g*255.);
            dstPixel.b = uint(img1.b*255.);

            srcPixel.r = uint(img2.r*255.);
            srcPixel.g = uint(img2.g*255.);
            srcPixel.b = uint(img2.b*255.);

            //Encode texture
            encode_image(dstPixel, srcPixel);
            //Decode texture
            if(decode){
                decode_image(dstPixel);
            }

             gl_FragColor = vec4(float(dstPixel.r)/255.,float(dstPixel.g)/255., float(dstPixel.b)/255.,1.0);
        }

      </script>
	<body>
          <canvas id="canvas"></canvas>
	  <script src="js/sceneSubjects/Shader.js"></script>
	  <script src="js/SceneManager.js"></script>
	  <script src="js/main.js"></script>
	</body>
</html>
